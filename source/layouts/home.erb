<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title> Weekly Sounds | <%= current_page.data.title || yield_content(:title) %></title>
    <%= stylesheet_link_tag "application" %>
    <%= favicon_tag 'images/favicon.png' %>
  </head>
  <body>
    <%= yield %>
    <%= partial "shared/propose_modal" %>
    <%= partial "shared/alert" %>
    <%= javascript_include_tag "application" %>
    <script>
      const signUp = document.querySelector("#mc-embedded-subscribe-form");
      const submitButton = document.querySelector("#mc-embedded-subscribe");

      register = () => {
        const msgSuccess = 'Merci pour ton inscription. N\'oublie pas de valider ton adresse mail !' ;
        const msgError = 'Oups, une erreur est survenue :(';
        fetch(signUp.action + '&EMAIL=' + signUp[0].value + '&c=', {
            method: signUp.method,
            mode: 'no-cors',
            headers: {
              'Content-Type': 'application/json; charset=utf-8'
            },
          }).then(function() {
            updateMsg('success', msgSuccess);
          }).catch(function(error) {
            updateMsg('error', msgError);
          });
      }

      subscribe = (e) => {
        e.preventDefault();
        register(signUp);
      }

      submitButton.addEventListener('click', subscribe);
    </script>
  </body>
</html>
